from malware_list_parser.malware_info_rss_plugin import MalwareInfoRssPlugin
import re

class SpyEyeTrackerDropUrls(MalwareInfoRssPlugin):
	def __init__(self):
		"""
		Builds a new object for parsing the SpyeEye Tracker drop urls feed
		"""
		super(SpyEyeTrackerDropUrls, self).__init__("https://spyeyetracker.abuse.ch/monitor.php?rssfeed=dropurls")
	
	def get_malware_info(self):
		"""
		Returns a formatted list summarizing the latest malware available on the SpyEye Tracker
		"""
		entry_summaries = [re.split(",\s*",entry.summary) for entry in self.get_rss_entries().entries]
		entry_dicts = map(
		    lambda summary : dict(map(
    		    lambda summary_line: [
    				summary_line.split(": ")[0],summary_line.split(": ")[1]
    			],
    		    [summary_line for summary_line in summary if len(summary_line.split(": ")) == 2]
    		)),
    		entry_summaries
    	)
		return entry_dicts
